Mappings:
  CustomConfig:
    ScalingConfig: 
      MetricNamespace: AWS/SQS
      TriggerMeasurement: NumberOfMessagesReceived
      TriggerStatistic: Average
      MeasurementPeriod: '300'
      NumCooldownPeriods: '1'
      LowerThreshold: '3'
      UpperThreshold: '7'
      LowerBreachIncrement: '-1'
      UpperBreachIncrement: '1'

##############################################
#### Do not modify values below this line ####
##############################################

Resources:
  CustomScalingAlarmHigh:
    Type: AWS::CloudWatch::Alarm
    Properties:
      AlarmActions:
      - {Ref: AutoScalingCustomScaleUpPolicy}
      AlarmDescription: ElasticBeanstalk custom scale up alarm
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
      - Name: AutoScalingGroupName
        Value: {Ref: AWSEBAutoScalingGroup}
      EvaluationPeriods:
        Fn::FindInMap: [CustomConfig, ScalingConfig, NumCooldownPeriods]
      MetricName:
        Fn::FindInMap: [CustomConfig, ScalingConfig, TriggerMeasurement]
      Namespace:
        Fn::FindInMap: [CustomConfig, ScalingConfig, MetricNamespace]
      Period:
        Fn::FindInMap: [CustomConfig, ScalingConfig, MeasurementPeriod]
      Statistic:
        Fn::FindInMap: [CustomConfig, ScalingConfig, TriggerStatistic]
      Threshold:
        Fn::FindInMap: [CustomConfig, ScalingConfig, UpperThreshold]
  CustomScalingAlarmLow:
    Type: AWS::CloudWatch::Alarm
    Properties:
      AlarmActions:
      - {Ref: AutoScalingCustomScaleDownPolicy}
      AlarmDescription: ElasticBeanstalk custom scale down alarm
      ComparisonOperator: LessThanThreshold
      Dimensions:
      - Name: AutoScalingGroupName
        Value: {Ref: AWSEBAutoScalingGroup}
      EvaluationPeriods:
        Fn::FindInMap: [CustomConfig, ScalingConfig, NumCooldownPeriods]
      MetricName:
        Fn::FindInMap: [CustomConfig, ScalingConfig, TriggerMeasurement]
      Namespace:
        Fn::FindInMap: [CustomConfig, ScalingConfig, MetricNamespace]
      Period:
        Fn::FindInMap: [CustomConfig, ScalingConfig, MeasurementPeriod]
      Statistic:
        Fn::FindInMap: [CustomConfig, ScalingConfig, TriggerStatistic]
      Threshold:
        Fn::FindInMap: [CustomConfig, ScalingConfig, LowerThreshold]
  AutoScalingCustomScaleDownPolicy:
    Type: AWS::AutoScaling::ScalingPolicy
    Properties:
      AdjustmentType: ChangeInCapacity
      AutoScalingGroupName: {Ref: AWSEBAutoScalingGroup}
      ScalingAdjustment:
        Fn::FindInMap: [CustomConfig, ScalingConfig, LowerBreachIncrement]
  AutoScalingCustomScaleUpPolicy:
    Type: AWS::AutoScaling::ScalingPolicy
    Properties:
      AdjustmentType: ChangeInCapacity
      AutoScalingGroupName: {Ref: AWSEBAutoScalingGroup}
      ScalingAdjustment:
        Fn::FindInMap: [CustomConfig, ScalingConfig, UpperBreachIncrement]
